<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5" />
    <title>bercriber's blog</title>
    <link rel="stylesheet" href="/css/base.css">
    <link rel="icon" href="/public/favicon.ico" />
    
  </head>
  <body>
    
      <header class="header">
        <h2 class="header-title">Bercriber's Blog</h2>
        <img class="header-icon" src="/public/bercriber.jpg" />
      </header>
    

    
    
  </body>
</html>


<div class="tags-list">


  
    <a class="tags-list-elem" href="/blog/tag/プログラミング">プログラミング</a>
  

</div>




<div class="post-header">
  <p class="post-date">2021/04/24 11:57</p>
  <hr>
  <h2 class="post-title">Next.jsで静的にネストしたルーティングでページを生成する</h2>
</div>

<div class="post-main">

  <ul>
<li>やりたいこと
<ul>
<li><code>/blog/[$category]/[$index]</code>みたいなページをビルド時に生成したい</li>
</ul>
</li>
<li>やったこと
<ul>
<li><code>/blog/[...id].js</code>のgetStaticPathsでがんばる</li>
</ul>
</li>
<li>つまずいたこと
<ul>
<li><code>/blog/[id].js</code>ではネストしたパスのページは生成できない</li>
</ul>
</li>
<li>気になること
<ul>
<li><code>getStaticPaths</code>と<code>getStaticProps</code>で二回ポスト一覧を取得している</li>
<li>関数の外で書けばいいだけ？今気づいたのであとでためす</li>
</ul>
</li>
</ul>
<pre><code class="language-javascript">// pages/blog/category/[...id].js

export function getStaticPaths() {
  let ps = getPostList().map(p =&gt; getPost(p))

  let categoryList = [Category]
  let categorizedPosts = {CategoryName: [Post]}
  
  // カテゴリーの記事全部を10記事ごとにわけてページを作りたい
  let pageSliceLength = Math.ceil(categorizedPost.length / 10);

  // type Paths = [{params: {id: [path]}]
  // ファイル名が[...id].jsであればidがキーになる
  let paths = []
  for (let category in categorizedPost) {
    for (let index = 0; index &lt; pageSliceLength; index++) {
      // /blog/[$category]/[$index] 
      const id = [category.toString(),index.toString()]
      paths.push({params: {id}})
    }
  }

  return {paths, fallback: false}
}

export function getStaticProps({params}) {
  const [category, index] = params.id

  const ps = getPostList().map(p =&gt; getPost(p)).filter(p =&gt; p.category == category)
  const posts = ps.slice(index * 10, index * 10 + 10)

  return {
    props: { posts, category, index }
  }
}
</code></pre>


</div>
