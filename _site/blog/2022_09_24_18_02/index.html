<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5" />
    <title>bercriber's blog</title>
    <link rel="stylesheet" href="/css/base.css">
    <link rel="icon" href="/public/favicon.ico" />
    
  </head>
  <body>
    
      <header class="header">
        <h2 class="header-title">Bercriber's Blog</h2>
        <img class="header-icon" src="/public/bercriber.jpg" />
      </header>
    

    
    
  </body>
</html>


<div class="tags-list">


  
    <a class="tags-list-elem" href="/blog/tag/プログラミング">プログラミング</a>
  

</div>




<div class="post-header">
  <p class="post-date">2022/09/24 18:02</p>
  <hr>
  <h2 class="post-title">GBEのu16+i8、キャリーしてない場合はフラグを立てるっぽいな</h2>
</div>

<div class="post-main">

  <p>前記事においてよくわからんなとかいってたやつ。単純にキャリーしないときにオンにするかんじやな。</p>
<p><code>.carry = (a ^ i ^ result) &amp; 0x100 != 0</code>を逆にして<code>.carry = (a ^ i ^ result) &amp; 0x100 == 0</code>でよいかんじでした。</p>
<pre><code class="language-zig">fn addU16ToSingedU8WithCarryHalf(a: u16, b: u8) u16OpResultWithCarryHalf {
    const n = @intCast(u16, bitClear(u8, b, 7));
    if (bitCheck(u8, b, 7)) {
        const i = 128 - n;
        const result = a -% i;
        return .{
            .result = result,
            .carry = (a ^ i ^ result) &amp; 0x100 == 0,
            .half = (a ^ i ^ result) &amp; 0x10 == 0,
            //.carry = (a &amp; 0xff) -% (i &amp; 0xff) &lt; (a &amp; 0xff),
            //.half = (a &amp; 0xf) -% (i &amp; 0xf) &lt; (a &amp; 0xf),
        };
    } else {
        const result = a +% n;
        return .{
            .result = result,
            .carry = (a ^ n ^ result) &amp; 0x100 != 0,
            .half = (a ^ n ^ result) &amp; 0x10 != 0,
        };
    
    }
}
</code></pre>


</div>
