---
date: 2023-05-03 00:26:00
title: PC環境設定
tags: PC
---


ﾊﾟｿｺﾝが４年ぶりに新しくなったのでセットアップ備忘録


## Scoop

- scoopから入れたせいでWindowsの設定からアプリを見てくれない問題あるな
- Google IMEが既定のIMEに設定できなくて困ってる
- うまくいかんので、コマンドラインツール以外はscoop使うのやめよ。
- [Google日本語入力を既定のIMEに設定できない問題はこれでいけた](https://setup-lab.net/windows10-ime-default/)


```powershell
# install scoope
Set-ExecutionPolicy RemoteSigned -Scope CurrentUser # Optional: Needed to run a remote script the first time
irm get.scoop.sh | iex

scoop install git

#scoop bucket add extras
#scoop install googlechrome

#scoop bucket add nonportable
#scoop install google-japanese-input-np

scoop install neovim
scoop install goneovim
scoop install vcredist #vcruntime140.dllがないとneovimに怒られたため

scoop install node
scoop install deno
scoop install yarn

scoop install stack
scoop install rustup
scoop install zig

scoop install hwmonitor

scoop install ripgrep
scoop install fzf

#scoop bucket add versions
#scoop install steam
```


## sandbox
- Windows先生に色々散らかされるのがつらいので`$HOME/box`以下を事実上のhomeとして運用する
- と思ったがOneDrive以下にぶ打ち込むことにするのでやっぱなし。
```powershell
#mkdir box
#cd box
#mkdir github
#mkdir downloads
#mkdir text
#mkdir memo
```


## Dotfile
```powershell
cd $HOME/Github
git clone https://github.com/kmtoki/dotfile

# require admine to make SymbolicLink
# Vim 
cd $HOME/AppData/Local
new-item -value "$HOME/Github/dotfile/nvim" -Name nvim -ItemType SymbolicLink
# Plug.vim
iwr -useb https://raw.githubusercontent.com/junegunn/vim-plug/master/plug.vim | ni "$(@($env:XDG_DATA_HOME, $env:LOCALAPPDATA)[$null -eq $env:XDG_DATA_HOME])/nvim-data/site/autoload/plug.vim" -Force

# PowerShell
cd "$HOME\OneDrive\ドキュメント\PowerShell"
new-item -value "$HOME/Github/dotfile/profile.ps1" -Name 'Microsoft.PowerShell_profile.ps1' -ItemType SymbolicLink
winget install Microsoft.PowerShell
# In Windows Terminal config. change startup shell to "C:\Program Files\PowerShell\7\pwsh.exe"
```


## UR22C オーディオインターフェイスのドライバー
- [link](https://japan.steinberg.net/jp/support/downloads/ur-c.html)



## Start up
- scoopeで入れたchromeが設定GUIから見つからないので手動でスタートアップフォルダーにショートカットをコピー
- [Windows 10 の起動時に自動的に実行するアプリを追加する](https://support.microsoft.com/ja-jp/windows/windows-10-%E3%81%AE%E8%B5%B7%E5%8B%95%E6%99%82%E3%81%AB%E8%87%AA%E5%8B%95%E7%9A%84%E3%81%AB%E5%AE%9F%E8%A1%8C%E3%81%99%E3%82%8B%E3%82%A2%E3%83%97%E3%83%AA%E3%82%92%E8%BF%BD%E5%8A%A0%E3%81%99%E3%82%8B-150da165-dcd9-7230-517b-cf3c295d89dd)


## Blog
- [bercriber's blog](http://blog-kmtoki.vercel.app/)

```powershell
#git config --global user.email "higumaido@gmail.com"
#git config --global user.name "kmtoki"
git clone https://github.com/kmtoki/blog
yarn install
```

## Neovim IME
- Neovimに乗り換えたいがはたして。IMEのオンオフをInsert modeのオンオフに絡めてくれる香り屋先生のVimが必須なんだけど、どうせNeovimにもあるだろうそうにちがいないたのむからあってくれ。
- (あったわ。)[https://github.com/iuchim/zenhan]これでいけそうたぶん。
- ありがとうございます。
- ついでにvimrcからneovimでは(デフォルトで設定されているやつ)[https://neovim.io/doc/user/vim_diff.html]を除去。

```vimscript
if has('win32')
  " zenhan. https://github.com/iuchim/zenhan
  function IMEToggle(bool)
    if a:bool
      call system(["zenhan", g:ime_state])
    else
      let g:ime_state = system(["zenhan"])
      call system(["zenhan", 0])
    endif
  endfunction

  augroup IMEToggle
    autocmd!
    autocmd InsertEnter * call IMEToggle(v:true)
    autocmd InsertLeave * call IMEToggle(v:false)
  augroup END
endif
```


## Neovim GUI goneovim
- (NeovimのGUIのフロントエンド)[https://github.com/akiyosi/goneovim]
- ~/.goneovim/settings.toml
- (ここから)[https://github.com/akiyosi/goneovim/wiki/Usage#configuration]まるっとコピーして必要なとこだけオン
- ModeEnablingIMEという機能があってそれでIME問題解決してる。俺の上記の試行錯誤なんやったんや。
- まぁいいや。
- [neovide](https://github.com/neovide/neovide)もためしたけどIMEｶﾞ～

```powershell
mkdir ~/.goneovim
cd ~/.goneovim
new-item -value "$HOME/Github/dotfile/goneovim_settings.toml" -Name settings.toml -ItemType SymbolicLink
```

## Ryzen Master
- [link](https://www.amd.com/ja/technologies/ryzen-master)
- Ecoモードにしてみるかと思ったら設定がない、Ecoボタンがない。PBOがBIOSで無効になってるとでないらしい。あとでみる


## Font
- [Ricty Diminished](https://github.com/edihbrandon/RictyDiminished)


## Keyboard
- なんかキーボードが調子悪い
- cとｖとｈの効きが悪い。予備のスイッチがまだ7個あるので交換する。
- sakuriosという名前のスイッチだった気がする。重めのサイレントリニアでとても良い。
- Preonicの予備か他のかほしいかも。押入れの奥底にDacytl mini的なやつがあったよな。作るの大変そう。

## QMK Firmware
- windowsでは[qmk-msys](https://msys.qmk.fm/)にビルドツールはすべておまかせがラク
- 今どきqmkコマンドがあるのね
- IMEのオンオフをするキーとして`Alt+GRV`が一般的だったのがはるかかなた昔の記憶だがqmkでそれをしようと思うと以下のコメントアウトされているようなのコードになる
- `tap_code16(LALT(KC_GRV))`を使うとTerminalに謎文字が余計に出力されてしまう問題がある
- 回避策として`register_code/unregister_code`を使うと問題なかった記憶がある
- MS IMEではｽﾝ...とされる
- `KC_INT4/KC_INC5`が変換/無変換にあたるので試すもｽﾝ..
- 結局ぐだって`Ctrl+Space`をIMEのトリガーにする設定をしてQMK側もそれに合わせる
- かなしい

```c
case IME:
  if (record->event.pressed) {
    //if (os_mode != 0) {
    //  if (is_ime) {
    //    tap_code(JP_MHEN);
    //  } else {
    //    tap_code(JP_HENK);
    //  }
    //} else {
    //  register_code(KC_LCTL);
    //  register_code(KC_GRV);
    //  unregister_code(KC_GRV);
    //  unregister_code(KC_LCTL);
    //  tap_code16(LALT(KC_GRV));
    //}
    tap_code16(LCTL(KC_SPC));
    is_ime = !is_ime;
  }
  return false;
```
 

```powershell
cd QMK_MSYS
.\shell_connector.cmd
cd ~/Github/qmk_firmware
#make preonic/rev3:kmtoki:flash
qmk flash -kb preonic/rev3 -km kmtoki
```


## MSVC
- [Microsoft C++ Build Tools](https://visualstudio.microsoft.com/ja/visual-cpp-build-tools/)


## Rust
- GUI系のアプリなんかだとMSVCでビルドする必要があるときもある

```powershell
rustup toolchain install stable-msvc
```

## Powershell
- scoopが通してくれるpathから見れるコマンドではシェルから独立して起動してくれないのでstartを噛ます
- Set-PSReadLineOptionでしぬほどマシになる
- lsの色が見にくいので他のやつ入れる
- [Get-ChildItemColor](https://github.com/joonro/Get-ChildItemColor)

```powershell
# $PROFILE.ps1
chcp 65001 > nul
[System.Console]::OutputEncoding = [System.Text.Encoding]::GetEncoding("utf-8")
[System.Console]::InputEncoding = [System.Text.Encoding]::GetEncoding("utf-8")
$env:LESSCHARSET = "utf-8"

Set-PSReadLineOption -EditMode Emacs -BellStyle None
Set-PSReadlineKeyHandler -Key Ctrl+v -Function Paste
Set-PSReadlineKeyHandler -Key Ctrl+p -Function HistorySearchBackward
Set-PSReadlineKeyHandler -Key Ctrl+n -Function HistorySearchForward
Set-PSReadLineKeyHandler -Key Tab -Function MenuComplete

function prompt {
  "`e[34m$($pwd.path)`e[0m`n> "
}

function Start-Chrome() {
  start 'C:\ProgramData\Microsoft\Windows\Start Menu\Programs\Google Chrome.lnk'
}

Set-Alias v C:\Users\higum\scoop\apps\goneovim\current\goneovim.exe
Set-Alias c Start-Chrome

#Install-Module Get-ChildItemColor
Import-Module Get-ChildItemColor
Set-Alias ls Get-ChildItemColor
```


## Windows Terminal勝手にIMEオンにする問題
- Windows Terminalがすっかりよくできたターミナルアプリになってしまってもうこれでいいわけだが
- アプリを開くとIMEが勝手にオンになるという仕様らしい。
- なんでやねん。
- たすけてzenhan.exe
- いけたとおもったらだめだったわ
- アプリ開くときはだめで新しくタブを開くときはこれでもいける
- どないすんの

```powershell
# $PROFILE.ps1
if (Get-Command "zenhan.exe") {
  zenhan 0
}
```
